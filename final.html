<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.c360a.salesforce.com/beacon/c360a/8a63a2ff-c0de-4503-83dd-eb517c01bd30/scripts/c360a.min.js" defer></script>
</head>
<body>
    <div class="final">
        <h1>Purchase done successfully</h1><br>
        <a href="index.html" class="gohome"><button  class="gohome">Back to HomePage</button></a><br>
    </div>
</body>
</html>



<script runat="server">
    Platform.Load("core", "1");
    try {
        var jsonpost = Platform.Request.GetPostData();
        json = Platform.Function.ParseJSON(jsonpost);
        if (jsonpost && jsonpost.length > 0) {
            var response = { success: true, message: "Data received successfully!" };
            var JsonResponse = Platform.Function.Stringify(response);
            Platform.Response.ContentType = "application/json";
            Platform.Response.Write(JsonResponse);

           // ✅ Salesforce OAuth Credentials (Do NOT expose in frontend)
        var clientId = "3MVG9jSKmPAPVo2JJ106tjUnx2RDd1ioHJvwF_AsO83SOvOHs12FqX5gh3FzFlnznPxkFoRWewA.G8Ndv.XMN";
        var clientSecret = "27E5D743D4864F1E4009D6617DC2F7FE4A858CD7F1EE2612D5062F14BF6EE99B";
        var username = "dipanshu.diwakerdcdo@aethereus.com";
        var password = "Salesforce@00"; // Store securely in SFMC Data Extensions

        var authUrl = "https://login.salesforce.com/services/oauth2/token";

        // ✅ Construct request payload
        var payload = {
            grant_type: "password",
            client_id: clientId,
            client_secret: clientSecret,
            username: username,
            password: password
        };

        // ✅ Make HTTP Request to Salesforce OAuth2
        var result = HTTP.Post(authUrl, "application/json", Platform.Function.Stringify(payload));

        if (!result || result.StatusCode != 200) {
            throw new Error("Salesforce Auth Failed: " + result.StatusText);
        }

        // ✅ Parse response
        var responseJson = Platform.Function.ParseJSON(result.Response[0]);

        var response = { 
            success: true, 
            access_token: responseJson.access_token, 
            instance_url: responseJson.instance_url 
        };

        // ✅ Return response as JSON
        Platform.Response.ContentType = "application/json";
        Platform.Response.Write(Platform.Function.Stringify(response));
       
        }



    }
    catch (ex) {
        // Handle exceptions or errors
        var errorResponse = { success: false, message: "An error occurred: " + ex.message };
        var errorJsonResponse = Platform.Function.Stringify(errorResponse);
        Platform.Response.ContentType = "application/json";
        Platform.Response.Write(errorJsonResponse);
    }





</script>